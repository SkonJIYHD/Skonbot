
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aterbot ÊéßÂà∂Èù¢Êùø</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .config-section {
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .config-section h3 {
            margin-top: 0;
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .form-group input, .form-group select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        .mod-list {
            margin-top: 10px;
        }
        .mod-item {
            display: flex;
            margin-bottom: 10px;
        }
        .mod-item input {
            flex: 1;
            margin-right: 10px;
        }
        .mod-item button {
            margin-left: 10px;
            background-color: #dc3545;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
        }
        .control-buttons {
            margin-top: 20px;
            display: flex;
            gap: 15px;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
        }
        .control-buttons button {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            flex: 1;
            max-width: 200px;
            min-width: 150px;
        }
        .start-btn {
            background-color: #28a745;
            color: white;
        }
        .stop-btn {
            background-color: #dc3545;
            color: white;
        }
        .save-btn {
            background-color: #007bff;
            color: white;
        }
        .status {
            padding: 10px;
            margin-top: 10px;
            border-radius: 5px;
        }
        .status.running {
            background-color: #d4edda;
            color: #155724;
        }
        .status.stopped {
            background-color: #f8d7da;
            color: #721c24;
        }
        .error-info {
            padding: 15px;
            margin-top: 10px;
            border-radius: 5px;
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            white-space: pre-wrap;
            max-height: 200px;
            overflow-y: auto;
        }
        .hidden {
            display: none;
        }
        .character-warning {
            animation: fadeIn 0.3s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .character-warning.error {
            background-color: #f8d7da !important;
            border-color: #f5c6cb !important;
            color: #721c24 !important;
        }
        .message {
            padding: 8px;
            margin: 5px 0;
            border-radius: 4px;
            border-left: 3px solid #ddd;
        }
        .message.chat { color: #28a745; }
        .message.error { color: #dc3545; background-color: #f8d7da; }
        .message.system { color: #007bff; background-color: #e7f3ff; }
        .message.server { color: #6f42c1; background-color: #f3e8ff; border-left: 3px solid #6f42c1; }
        .message.game { color: #fd7e14; background-color: #fff3e0; }
        .message.unknown { color: #6c757d; background-color: #f8f9fa; }
        
        /* Â∏ÆÂä©Áõ∏ÂÖ≥Ê†∑Âºè */
        .help-btn {
            background-color: #17a2b8;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            font-family: Arial, sans-serif;
            transition: background-color 0.3s ease;
        }
        .help-btn:hover {
            background-color: #138496;
        }
        
        .help-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 1000;
            font-family: Arial, sans-serif;
        }
        
        .help-modal-content {
            background: white;
            margin: 0;
            padding: 20px;
            border-radius: 0;
            width: 100vw;
            height: 100vh;
            overflow-y: auto;
            position: relative;
            box-shadow: none;
        }
        
        

        /* ÂìçÂ∫îÂºèËÆæËÆ° - ÁßªÂä®Á´Ø‰ºòÂåñ */
        @media (max-width: 768px) {
            .help-modal-content {
                padding: 15px;
            }
            
            
            
            .help-title {
                font-size: 24px !important;
                margin-top: 10px !important;
                text-align: center !important;
            }
            
            .help-section {
                margin: 0 0 15px 0 !important;
                padding: 15px !important;
            }
            
            .help-section-title {
                font-size: 16px !important;
            }
            
            .help-list {
                font-size: 14px;
                line-height: 1.6;
            }
            
            .help-faq-item {
                padding: 12px !important;
                font-size: 14px;
                line-height: 1.5;
            }
            
            .help-footer {
                padding: 20px 0 !important;
            }
            
            .help-confirm-btn {
                padding: 12px 25px !important;
                font-size: 16px !important;
                width: 100%;
                box-sizing: border-box;
            }
        }

        /* Âπ≥ÊùøËÆæÂ§á‰ºòÂåñ */
        @media (min-width: 769px) and (max-width: 1024px) {
            .help-modal-content {
                padding: 25px;
            }
            
            
            
            .help-title {
                font-size: 28px !important;
            }
            
            .help-section {
                max-width: 90% !important;
                margin: 0 auto 20px auto !important;
            }
        }

        /* Â§ßÂ±èËÆæÂ§á‰ºòÂåñ */
        @media (min-width: 1025px) {
            .help-modal-content {
                padding: 30px 40px;
            }
            
            
            
            .help-section {
                max-width: 1000px !important;
                margin: 0 auto 25px auto !important;
            }
            
            .help-footer {
                max-width: 1000px !important;
                margin: 30px auto 0 auto !important;
            }
        }
        
        .help-title {
            color: #007bff;
            margin-top: 0;
            margin-bottom: 25px;
            font-size: 24px;
            border-bottom: 2px solid #e9ecef;
            padding-bottom: 10px;
        }
        
        .help-section {
            margin-bottom: 25px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #f8f9fa;
        }
        
        .help-section-title {
            margin-top: 0;
            margin-bottom: 15px;
            font-size: 18px;
        }
        .help-section-title.quick-start {
            color: #28a745;
        }
        .help-section-title.features {
            color: #fd7e14;
        }
        .help-section-title.troubleshoot {
            color: #6f42c1;
        }
        
        .help-list {
            line-height: 1.8;
            margin: 0;
            padding-left: 20px;
        }
        .help-list li {
            margin-bottom: 8px;
        }
        
        .help-faq-item {
            background-color: white;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 12px;
            border: 1px solid #e9ecef;
            line-height: 1.6;
        }
        .help-faq-item:last-child {
            margin-bottom: 0;
        }
        
        .help-footer {
            text-align: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #e9ecef;
        }
        
        .help-confirm-btn {
            background-color: #28a745;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: background-color 0.3s ease;
        }
        .help-confirm-btn:hover {
            background-color: #218838;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Aterbot ÊéßÂà∂Èù¢Êùø</h1>
        
        <div class="config-section">
            <h3>üìñ ‰ΩøÁî®Â∏ÆÂä©</h3>
            <div class="form-group">
                <label>Êü•ÁúãÊéßÂà∂Èù¢Êùø‰ΩøÁî®ÊåáÂçó:</label>
                <button onclick="showHelp()" class="help-btn" style="width: 100%; padding: 10px 20px; font-size: 16px;">
                    ‚ùì ÊâìÂºÄ‰ΩøÁî®Â∏ÆÂä©
                </button>
                <div style="margin-top: 8px; font-size: 12px; color: #666;">
                    ÂåÖÂê´Âø´ÈÄüÂºÄÂßãÊåáÂçó„ÄÅÂäüËÉΩ‰ªãÁªçÂíåÂ∏∏ËßÅÈóÆÈ¢òËß£Á≠î
                </div>
            </div>
        </div>

        <!-- Â∏ÆÂä©ÂºπÁ™ó -->
        <div id="help-modal" class="help-modal">
            <div class="help-modal-content">
                
                <h2 class="help-title" style="margin-top: 20px; text-align: center; font-size: 32px;">üéÆ Aterbot ÊéßÂà∂Èù¢Êùø‰ΩøÁî®ÊåáÂçó</h2>
                
                <div class="help-section" style="max-width: 1000px; margin: 0 auto 25px auto;">
                    <h3 class="help-section-title quick-start">üìã Âø´ÈÄüÂºÄÂßã</h3>
                    <ol class="help-list">
                        <li><strong>ÈÖçÁΩÆÊúçÂä°Âô®:</strong> Âú®"Âü∫Á°ÄÈÖçÁΩÆ"‰∏≠Â°´ÂÖ•MinecraftÊúçÂä°Âô®Âú∞ÂùÄ</li>
                        <li><strong>ËÆæÁΩÆÁî®Êà∑Âêç:</strong> ‰∏∫Êú∫Âô®‰∫∫ÈÄâÊã©‰∏Ä‰∏™ÂêàÈÄÇÁöÑÁî®Êà∑Âêç</li>
                        <li><strong>ÁÇπÂáªÂêØÂä®:</strong> ‰øùÂ≠òÈÖçÁΩÆÂêéÁÇπÂáª"ÂêØÂä®Êú∫Âô®‰∫∫"ÊåâÈíÆ</li>
                        <li><strong>ÂºÄÂßãÊéßÂà∂:</strong> ÂêØÂä®ÂêéÂèØ‰ª•ÂèëÈÄÅËÅäÂ§©Ê∂àÊÅØÂíåÊâßË°åÂëΩ‰ª§</li>
                    </ol>
                </div>

                <div class="help-section" style="max-width: 1000px; margin: 0 auto 25px auto;">
                    <h3 class="help-section-title features">‚öôÔ∏è ‰∏ªË¶ÅÂäüËÉΩ</h3>
                    <ul class="help-list">
                        <li><strong>üé® ÁöÆËÇ§ÈÖçÁΩÆ:</strong> ÊîØÊåÅÈªòËÆ§ÁöÆËÇ§„ÄÅËá™ÂÆö‰πâURL„ÄÅLittleSkinÁöÆËÇ§Á´ô</li>
                        <li><strong>üîß Ê®°ÁªÑÊîØÊåÅ:</strong> Ëá™ÈÄÇÂ∫îÊ£ÄÊµãÊúçÂä°Âô®modÊàñÊâãÂä®ÈÖçÁΩÆ</li>
                        <li><strong>üí¨ ÂÆûÊó∂ËÅäÂ§©:</strong> Êü•ÁúãÊúçÂä°Âô®Ê∂àÊÅØÂπ∂ÂèëÈÄÅËÅäÂ§©</li>
                        <li><strong>üìã ÂëΩ‰ª§ÊâßË°å:</strong> ÊâßË°åMinecraftÂëΩ‰ª§Âπ∂Êü•ÁúãÂìçÂ∫î</li>
                        <li><strong>üìä Êó•ÂøóÁõëÊéß:</strong> ÂÆûÊó∂Êü•ÁúãÊú∫Âô®‰∫∫ËøêË°åÁä∂ÊÄÅ</li>
                    </ul>
                </div>

                <div class="help-section" style="max-width: 1000px; margin: 0 auto 25px auto;">
                    <h3 class="help-section-title troubleshoot">üõ†Ô∏è Â∏∏ËßÅÈóÆÈ¢ò</h3>
                    <div class="help-faq-item">
                        <strong>Q: Êú∫Âô®‰∫∫Êó†Ê≥ïËøûÊé•ÊúçÂä°Âô®Ôºü</strong><br>
                        A: Ê£ÄÊü•ÊúçÂä°Âô®Âú∞ÂùÄ„ÄÅÁ´ØÂè£ÊòØÂê¶Ê≠£Á°ÆÔºåÁ°ÆËÆ§ÊúçÂä°Âô®‰∏∫JavaÁâà‰∏îÊú™ÂºÄÂêØÊ≠£ÁâàÈ™åËØÅ
                    </div>
                    <div class="help-faq-item">
                        <strong>Q: Áî®Êà∑ÂêçÂåÖÂê´ÈùûÊ≥ïÂ≠óÁ¨¶Ôºü</strong><br>
                        A: Âè™ËÉΩ‰ΩøÁî®Â≠óÊØçÂíåÊï∞Â≠óÔºå‰∏çÊîØÊåÅ‰∏≠Êñá„ÄÅ‰∏ãÂàíÁ∫øÁ≠âÁâπÊÆäÂ≠óÁ¨¶
                    </div>
                    <div class="help-faq-item">
                        <strong>Q: Êú∫Âô®‰∫∫Ë¢´Ë∏¢Âá∫ÊúçÂä°Âô®Ôºü</strong><br>
                        A: ÂèØËÉΩÊòØÁî®Êà∑ÂêçÂÜ≤Á™ÅÊàñÊúçÂä°Âô®ÈôêÂà∂ÔºåÂ∞ùËØïÊõ¥Êç¢Áî®Êà∑ÂêçÊàñËÅîÁ≥ªÊúçÂä°Âô®ÁÆ°ÁêÜÂëò
                    </div>
                </div>

                <div class="help-footer" style="max-width: 1000px; margin: 30px auto 0 auto; padding: 30px 0;">
                    <button onclick="setHelpShown(); hideHelp();" class="help-confirm-btn" style="padding: 15px 40px; font-size: 18px;">
                        ‚úÖ ÊàëÁü•ÈÅì‰∫ÜÔºåÂºÄÂßã‰ΩøÁî®
                    </button>
                </div>
            </div>
        </div>

        <div class="config-section">
            <h3>Âü∫Á°ÄÈÖçÁΩÆ</h3>
            <div class="form-group">
                <label>ÊúçÂä°Âô®Âú∞ÂùÄ:</label>
                <input type="text" id="server-address" placeholder="ÊúçÂä°Âô®Âú∞ÂùÄ:Á´ØÂè£">
                <div style="margin-top: 5px; font-size: 12px; color: #666;">
                    ËæìÂÖ•Ê†ºÂºè: ÊúçÂä°Âô®Âú∞ÂùÄ:Á´ØÂè£ÔºåÂ¶ÇÊûú‰∏çÂ°´Á´ØÂè£ÈªòËÆ§‰ΩøÁî®25565
                </div>
            </div>
            <div class="form-group">
                <label>Áî®Êà∑Âêç:</label>
                <input type="text" id="username" placeholder="Êú∫Âô®‰∫∫Áî®Êà∑Âêç">
                <div style="margin-top: 5px;">
                    <button type="button" onclick="suggestUsername()" style="background-color: #17a2b8; color: white; border: none; padding: 5px 10px; border-radius: 3px; font-size: 12px;">üé≤ ÈöèÊú∫Êé®ËçêÁî®Êà∑Âêç</button>
                    <small style="margin-left: 10px; color: #666;">Â¶ÇÊûúÂΩìÂâçÁî®Êà∑ÂêçË¢´Ë∏¢Âá∫ÔºåÂèØ‰ª•Â∞ùËØïÂÖ∂‰ªñÂêçÂ≠óÂñµ</small>
                </div>
                <div id="username-warning" class="character-warning" style="display: none; margin-top: 5px; padding: 8px; background-color: #fff3cd; border: 1px solid #ffeaa7; border-radius: 4px; font-size: 12px; color: #856404;">
                    <strong>‚ö†Ô∏è Áî®Êà∑ÂêçÂåÖÂê´ÈùûÊ≥ïÂ≠óÁ¨¶ÔºÅ</strong><br>
                    MinecraftÊúçÂä°Âô®ÈÄöÂ∏∏Âè™ÂÖÅËÆ∏Â≠óÊØç(a-z, A-Z)ÂíåÊï∞Â≠ó(0-9)Ôºå‰∏çÊîØÊåÅ‰∏ãÂàíÁ∫ø(_)„ÄÅÁ©∫Ê†ºÊàñÁâπÊÆäÁ¨¶Âè∑„ÄÇ<br>
                    Âª∫ËÆÆ‰ΩøÁî®Á∫ØÂ≠óÊØçÊï∞Â≠óÁªÑÂêàÔºåÂ¶Ç: BotSkon, AterBot123
                </div>
            </div>
            <div class="form-group">
                <label>Ê∏∏ÊàèÁâàÊú¨:</label>
                <select id="java-version">
                    <option value="1.21.1">1.21.1</option>
                    <option value="1.21">1.21</option>
                    <option value="1.20.6">1.20.6</option>
                    <option value="1.20.4">1.20.4</option>
                    <option value="1.20.1">1.20.1</option>
                    <option value="1.19.4">1.19.4</option>
                    <option value="1.18.2">1.18.2</option>
                </select>
            </div>
            <div class="form-group">
                <label>ËÆ§ËØÅÊñπÂºè:</label>
                <select id="auth" disabled>
                    <option value="offline">Á¶ªÁ∫øÊ®°Âºè (Êú∫Âô®‰∫∫‰ªÖÊîØÊåÅÊ≠§Ê®°Âºè)</option>
                </select>
                <div style="margin-top: 5px; padding: 6px; background-color: #e7f3ff; border: 1px solid #b8daff; border-radius: 4px; font-size: 12px; color: #004085;">
                    <strong>üí° ÊèêÁ§∫:</strong> Êú∫Âô®‰∫∫Âè™ËÉΩ‰ΩøÁî®Á¶ªÁ∫øÊ®°ÂºèËøûÊé•ÊúçÂä°Âô®Ôºå‰∏çÊîØÊåÅÊ≠£ÁâàÈ™åËØÅ„ÄÇ
                </div>
            </div>
        </div>

        <div class="config-section">
            <h3>üé® ÁöÆËÇ§ÈÖçÁΩÆ</h3>
            <div class="form-group">
                <label>ÁöÆËÇ§Ê®°Âºè:</label>
                <select id="skinMode" onchange="updateSkinMode()">
                    <option value="default">ÈªòËÆ§ÁöÆËÇ§ (Steve)</option>
                    <option value="url">Ëá™ÂÆö‰πâÁöÆËÇ§URL</option>
                    <option value="yggdrasil">Á¨¨‰∏âÊñπÁöÆËÇ§Á´ô (Yggdrasil)</option>
                    <option value="littleskin">LittleSkinÁöÆËÇ§Á´ô</option>
                </select>
            </div>

            <div id="skin-url-section" class="form-group" style="display: none;">
                <label>ÁöÆËÇ§URL:</label>
                <input type="url" id="skinUrl" placeholder="https://example.com/skin.png">
            </div>

            <div id="yggdrasil-section" style="display: none;">
                <div class="form-group">
                    <label>YggdrasilÊúçÂä°Âô®:</label>
                    <select id="skinServer" onchange="updateYggdrasilUrl()">
                        <option value="https://littleskin.cn/api/yggdrasil">LittleSkin</option>
                        <option value="https://auth.mc-user.com:233">Áªü‰∏ÄÈÄöË°åËØÅ</option>
                        <option value="custom">Ëá™ÂÆö‰πâÊúçÂä°Âô®</option>
                    </select>
                </div>
                <div id="custom-yggdrasil" class="form-group" style="display: none;">
                    <label>Ëá™ÂÆö‰πâYggdrasil URL:</label>
                    <input type="url" id="customYggdrasilUrl" placeholder="https://your-server.com/api/yggdrasil">
                </div>
                <div class="form-group">
                    <label>ÁöÆËÇ§Á´ôÁî®Êà∑Âêç:</label>
                    <input type="text" id="yggdrasilUsername" placeholder="Âú®ÁöÆËÇ§Á´ôÁöÑÁî®Êà∑Âêç">
                </div>
            </div>

            <div id="littleskin-section" style="display: none;">
                <div class="form-group">
                    <label>LittleSkinÁî®Êà∑Âêç:</label>
                    <input type="text" id="littleskinUsername" placeholder="LittleSkinÁî®Êà∑Âêç">
                </div>
                <div class="form-group">
                    <label style="display: flex; align-items: center; cursor: pointer;">
                        <input type="checkbox" id="enableLittleskinAuth" onchange="updateLittleskinAuth()" style="margin-right: 8px;"> 
                        ÂêØÁî®LittleSkinËÆ§ËØÅ
                    </label>
                </div>
                <div id="littleskin-auth-section" class="form-group" style="display: none;">
                    <label>LittleSkinÂØÜÁ†Å:</label>
                    <input type="password" id="littleskinPassword" placeholder="LittleSkinË¥¶Êà∑ÂØÜÁ†Å">
                </div>
            </div>
        </div>

        <div class="config-section">
            <h3>üîß Ê®°ÁªÑÈÖçÁΩÆ</h3>
            <div class="form-group">
                <label style="display: flex; align-items: center; cursor: pointer;">
                    <input type="checkbox" id="adaptive-mods" onchange="updateAdaptiveMode()" style="margin-right: 8px;"> 
                    ÂêØÁî®Ëá™ÈÄÇÂ∫îmodÊ®°Âºè
                </label>
                <div style="margin: 8px 0; padding: 8px; background-color: #d1ecf1; border: 1px solid #bee5eb; border-radius: 4px; font-size: 12px;">
                    <strong>üî• Ëá™ÈÄÇÂ∫îÊ®°Âºè:</strong> Êú∫Âô®‰∫∫‰ºöËá™Âä®Ê£ÄÊµãÊúçÂä°Âô®Ë¶ÅÊ±ÇÁöÑmodÂàóË°®ÔºåÁÑ∂Âêé‰º™Ë£ÖÊàêÊã•ÊúâËøô‰∫õmodÔºåÊó†ÈúÄÊâãÂä®ÈÖçÁΩÆÂñµÔºÅ
                </div>
            </div>
            <div id="manual-mods-section">
                <div class="form-group">
                    <label>ÊâãÂä®Ê∑ªÂä†modÂàóË°®:</label>
                    <div style="margin: 8px 0; padding: 8px; background-color: #fff3cd; border: 1px solid #ffeaa7; border-radius: 4px; font-size: 12px;">
                        <strong>üìù ÊâãÂä®Ê®°Âºè:</strong> Âú®ÂÖ≥Èó≠Ëá™ÈÄÇÂ∫îÊ®°ÂºèÊó∂Ôºå‰Ω†ÂèØ‰ª•ÊâãÂä®Ê∑ªÂä†ÊúçÂä°Âô®ÈúÄË¶ÅÁöÑmodÂêçÁß∞„ÄÇÂ∏∏ËßÅÁöÑmodÂ¶ÇÔºöforge„ÄÅoptifine„ÄÅjei„ÄÅjourneymapÁ≠â„ÄÇ
                    </div>
                    <div id="mod-list" class="mod-list"></div>
                    <div style="margin-top: 10px;">
                        <button type="button" onclick="addMod()" style="background-color: #28a745; color: white; border: none; padding: 8px 15px; border-radius: 4px; margin-right: 10px;">‚ûï Ê∑ªÂä†mod</button>
                        <button type="button" onclick="addCommonMods()" style="background-color: #17a2b8; color: white; border: none; padding: 8px 15px; border-radius: 4px;">üéØ Ê∑ªÂä†Â∏∏Áî®mod</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="config-section">
            <h3>üéÆ Êú∫Âô®‰∫∫ÊéßÂà∂Èù¢Êùø</h3>
            <div class="control-buttons">
                <button class="save-btn" onclick="saveConfig()">üíæ ‰øùÂ≠òÈÖçÁΩÆ</button>
                <button id="toggle-btn" class="start-btn" onclick="toggleBot()">‚ñ∂Ô∏è ÂêØÂä®Êú∫Âô®‰∫∫</button>
            </div>
            <div id="status" class="status stopped">Êú∫Âô®‰∫∫Áä∂ÊÄÅ: Â∑≤ÂÅúÊ≠¢</div>
        </div>

        <div id="error-info" class="error-info hidden"></div>

        <div class="config-section" id="command-section" style="display: none;">
            <h3>üéÆ Êú∫Âô®‰∫∫ÂëΩ‰ª§ÊéßÂà∂</h3>
            <div class="form-group">
                <label>ÊâßË°åMinecraftÂëΩ‰ª§:</label>
                <div style="display: flex; gap: 10px;">
                    <input type="text" id="minecraft-command" placeholder="ËæìÂÖ•ÂëΩ‰ª§ (Â¶Ç: /time set day)" style="flex: 1;">
                    <button onclick="executeMinecraftCommand()" style="background-color: #28a745; color: white; border: none; padding: 8px 15px; border-radius: 4px;">ÊâßË°å</button>
                </div>
            </div>

            <div class="form-group">
                <label>ÂèëÈÄÅËÅäÂ§©Ê∂àÊÅØ:</label>
                <div style="display: flex; gap: 10px;">
                    <input type="text" id="chat-message" placeholder="ËæìÂÖ•Ë¶ÅÂèëÈÄÅÁöÑÊ∂àÊÅØ" style="flex: 1;">
                    <button onclick="sendChatMessage()" style="background-color: #007bff; color: white; border: none; padding: 8px 15px; border-radius: 4px;">ÂèëÈÄÅ</button>
                </div>
            </div>

            <div class="form-group">
                <label>ÊúçÂä°Âô®Ê∂àÊÅØÁõëÊéß:</label>
                <div id="server-messages" style="height: 200px; overflow-y: auto; border: 1px solid #ddd; border-radius: 4px; padding: 10px; background-color: #f0f8ff; font-family: 'Courier New', monospace; font-size: 12px; margin-bottom: 10px;">
                    <!-- ÊúçÂä°Âô®Ê∂àÊÅØÂ∞ÜÂú®ËøôÈáåÊòæÁ§∫ -->
                </div>
                <button onclick="clearServerMessages()" style="background-color: #6c757d; color: white; border: none; padding: 5px 10px; border-radius: 3px; margin-right: 10px;">Ê∏ÖÈô§Ê∂àÊÅØ</button>
                <button onclick="toggleAutoScroll()" id="auto-scroll-btn" style="background-color: #28a745; color: white; border: none; padding: 5px 10px; border-radius: 3px;">Ëá™Âä®ÊªöÂä®: ÂºÄ</button>
            </div>

            <div class="form-group">
                <label>üìã Êåá‰ª§ÊâßË°åÊó•Âøó:</label>
                <div id="command-logs" style="height: 150px; overflow-y: auto; border: 1px solid #ddd; border-radius: 4px; padding: 10px; background-color: #f8f8ff; font-family: 'Courier New', monospace; font-size: 12px; margin-bottom: 10px;">
                    <!-- Êåá‰ª§Êó•ÂøóÂ∞ÜÂú®ËøôÈáåÊòæÁ§∫ -->
                </div>
                <button onclick="clearCommandLogs()" style="background-color: #6c757d; color: white; border: none; padding: 5px 10px; border-radius: 3px; margin-right: 10px;">Ê∏ÖÈô§Êó•Âøó</button>
                <button onclick="exportCommandLogs()" style="background-color: #17a2b8; color: white; border: none; padding: 5px 10px; border-radius: 3px;">ÂØºÂá∫Êó•Âøó</button>
            </div>
        </div>
    </div>

    <script>
        let config = {};
        let mods = [];
        let eventSource = null;
        let autoScroll = true;
        let commandLogs = [];
        let maxCommandLogs = 100;

        // È°µÈù¢Âä†ËΩΩÊó∂Ëé∑ÂèñÂΩìÂâçÈÖçÁΩÆ
        window.onload = function() {
            loadConfig();
            updateStatus();
            setInterval(updateStatus, 2000);
            
            // Ê£ÄÊü•ÊòØÂê¶È¶ñÊ¨°‰ΩøÁî®
            checkFirstTimeUser();
        };

        // Ê£ÄÊü•ÊòØÂê¶È¶ñÊ¨°‰ΩøÁî®
        function checkFirstTimeUser() {
            const hasShownHelp = localStorage.getItem('aterbot_help_shown');
            if (!hasShownHelp) {
                // Âª∂ËøüÊòæÁ§∫Â∏ÆÂä©ÔºåËÆ©È°µÈù¢ÂÆåÂÖ®Âä†ËΩΩ
                setTimeout(() => {
                    showHelp();
                }, 1000);
            }
        }

        // ÊòæÁ§∫Â∏ÆÂä©ÂºπÁ™ó
        function showHelp() {
            document.getElementById('help-modal').style.display = 'block';
            document.body.style.overflow = 'hidden'; // Èò≤Ê≠¢ËÉåÊôØÊªöÂä®
        }

        // ÈöêËóèÂ∏ÆÂä©ÂºπÁ™ó
        function hideHelp() {
            document.getElementById('help-modal').style.display = 'none';
            document.body.style.overflow = 'auto'; // ÊÅ¢Â§çÊªöÂä®
        }

        // Ê†áËÆ∞Â∏ÆÂä©Â∑≤ÊòæÁ§∫
        function setHelpShown() {
            localStorage.setItem('aterbot_help_shown', 'true');
        }

        function parseServerAddress(input) {
            const value = input.value.trim();
            if (!value) return;

            if (value.includes(':')) {
                const parts = value.split(':');
                if (parts.length === 2) {
                    const host = parts[0].trim();
                    const port = parts[1].trim();

                    if (port && !/^\d+$/.test(port)) {
                        input.style.borderColor = '#dc3545';
                        input.title = 'Á´ØÂè£ÂøÖÈ°ªÊòØÊï∞Â≠óÂñµÔºÅ';
                    } else if (port && (parseInt(port) < 1 || parseInt(port) > 65535)) {
                        input.style.borderColor = '#dc3545';
                        input.title = 'Á´ØÂè£ËåÉÂõ¥ÂøÖÈ°ªÂú®1-65535‰πãÈó¥ÂñµÔºÅ';
                    } else {
                        input.style.borderColor = '#28a745';
                        input.title = `ÊúçÂä°Âô®: ${host}ÔºåÁ´ØÂè£: ${port || '25565'}`;
                    }
                }
            } else {
                input.style.borderColor = '#17a2b8';
                input.title = `ÊúçÂä°Âô®: ${value}ÔºåÁ´ØÂè£: 25565 (ÈªòËÆ§)`;
            }
        }

        function validateUsername(input) {
            const username = input.value;
            const warningEl = document.getElementById('username-warning');

            const illegalChars = username.match(/[^a-zA-Z0-9]/g);

            if (illegalChars && illegalChars.length > 0) {
                const uniqueChars = [...new Set(illegalChars)];
                const suggestionName = username.replace(/[^a-zA-Z0-9]/g, '') || 'BotSkon';
                warningEl.innerHTML = `
                    <strong>üö´ Áî®Êà∑ÂêçÂåÖÂê´ÈùûÊ≥ïÂ≠óÁ¨¶: ${uniqueChars.join(', ')}</strong><br>
                    <strong>üí° Âª∫ËÆÆ‰øÆÊîπ‰∏∫:</strong> <code style="background: #f0f0f0; padding: 2px 4px; border-radius: 3px;">${suggestionName}</code><br>
                    <small>Âè™ÂÖÅËÆ∏‰ΩøÁî®Â≠óÊØç(a-z, A-Z)ÂíåÊï∞Â≠ó(0-9)Ôºå‰∏çÊîØÊåÅ‰∏ãÂàíÁ∫ø„ÄÅÁ©∫Ê†º„ÄÅ‰∏≠ÊñáÁ≠âÁâπÊÆäÂ≠óÁ¨¶Âñµ~</small>
                `;
                warningEl.className = 'character-warning error';
                warningEl.style.display = 'block';
            } else if (username.length > 16) {
                warningEl.innerHTML = `
                    <strong>üìè Áî®Êà∑ÂêçËøáÈïøÔºÅ</strong><br>
                    MinecraftÁî®Êà∑ÂêçÈôêÂà∂‰∏∫ÊúÄÂ§ö16‰∏™Â≠óÁ¨¶ÔºåÂΩìÂâçÈïøÂ∫¶: ${username.length} ‰∏™Â≠óÁ¨¶<br>
                    <strong>Âª∫ËÆÆÁº©Áü≠‰∏∫:</strong> <code>${username.substring(0, 16)}</code>
                `;
                warningEl.className = 'character-warning error';
                warningEl.style.display = 'block';
            } else if (username.length >= 3) {
                warningEl.innerHTML = `
                    <strong>‚úÖ Áî®Êà∑ÂêçÊ†ºÂºèÂÆåÂÖ®Ê≠£Á°ÆÂñµÔºÅ</strong><br>
                    Êú∫Âô®‰∫∫ÂèØ‰ª•Ê≠£Â∏∏‰ΩøÁî®Ê≠§Áî®Êà∑ÂêçËøõÂÖ•ÊúçÂä°Âô®Âñµ~
                `;
                warningEl.className = 'character-warning';
                warningEl.style.display = 'block';
                warningEl.style.backgroundColor = '#d1ecf1';
                warningEl.style.borderColor = '#bee5eb';
                warningEl.style.color = '#0c5460';
            } else {
                warningEl.style.display = 'none';
            }
        }

        function loadConfig() {
            fetch('/api/config')
                .then(response => response.json())
                .then(data => {
                    config = data;
                    updateUI();
                })
                .catch(error => console.error('Âä†ËΩΩÈÖçÁΩÆÂ§±Ë¥•:', error));
        }

        function updateUI() {
            const host = config.client?.host || '';
            const port = config.client?.port || '';
            const serverAddress = host && port ? `${host}:${port}` : (host || '');

            document.getElementById('server-address').value = serverAddress;
            document.getElementById('username').value = config.client?.username || '';
            document.getElementById('java-version').value = config.client?.version || '1.21.1';
            document.getElementById('auth').value = config.client?.auth || 'offline';

            mods = config.client?.mods || [];
            updateModList();

            document.getElementById('adaptive-mods').checked = config.client?.adaptiveMods || false;
            updateAdaptiveMode();

            if (config.client?.skinMode) {
                document.getElementById('skinMode').value = config.client.skinMode;
                updateSkinMode();
            }
            if (config.client?.skinUrl) {
                document.getElementById('skinUrl').value = config.client.skinUrl;
            }
            if (config.client?.yggdrasilServer) {
                const serverSelect = document.getElementById('skinServer');
                if ([...serverSelect.options].some(option => option.value === config.client.yggdrasilServer)) {
                    serverSelect.value = config.client.yggdrasilServer;
                } else {
                    serverSelect.value = 'custom';
                    document.getElementById('customYggdrasilUrl').value = config.client.yggdrasilServer;
                }
                updateYggdrasilUrl();
            }
            if (config.client?.yggdrasilUsername) {
                document.getElementById('yggdrasilUsername').value = config.client.yggdrasilUsername;
            }
            if (config.client?.littleskinUsername) {
                document.getElementById('littleskinUsername').value = config.client.littleskinUsername;
            }
            if (config.client?.littleskinPassword) {
                document.getElementById('littleskinPassword').value = config.client.littleskinPassword;
            }
            if (config.client?.enableLittleskinAuth !== undefined) {
                document.getElementById('enableLittleskinAuth').checked = config.client.enableLittleskinAuth;
                updateLittleskinAuth();
            }
        }

        function updateSkinMode() {
            const skinMode = document.getElementById('skinMode').value;
            const skinUrlSection = document.getElementById('skin-url-section');
            const yggdrasilSection = document.getElementById('yggdrasil-section');
            const littleskinSection = document.getElementById('littleskin-section');

            skinUrlSection.style.display = 'none';
            yggdrasilSection.style.display = 'none';
            littleskinSection.style.display = 'none';

            if (skinMode === 'url') {
                skinUrlSection.style.display = 'block';
            } else if (skinMode === 'yggdrasil') {
                yggdrasilSection.style.display = 'block';
            } else if (skinMode === 'littleskin') {
                littleskinSection.style.display = 'block';
            }
        }

        function updateYggdrasilUrl() {
            const serverSelect = document.getElementById('skinServer');
            const customSection = document.getElementById('custom-yggdrasil');

            if (serverSelect.value === 'custom') {
                customSection.style.display = 'block';
            } else {
                customSection.style.display = 'none';
            }
        }

        function updateLittleskinAuth() {
            const enableAuth = document.getElementById('enableLittleskinAuth').checked;
            const authSection = document.getElementById('littleskin-auth-section');

            if (enableAuth) {
                authSection.style.display = 'block';
            } else {
                authSection.style.display = 'none';
            }
        }

        function updateAdaptiveMode() {
            const isAdaptive = document.getElementById('adaptive-mods').checked;
            const manualSection = document.getElementById('manual-mods-section');

            if (isAdaptive) {
                manualSection.style.opacity = '0.5';
                manualSection.style.pointerEvents = 'none';
            } else {
                manualSection.style.opacity = '1';
                manualSection.style.pointerEvents = 'auto';
            }
        }

        function addMod() {
            mods.push('');
            updateModList();
        }

        function removeMod(index) {
            mods.splice(index, 1);
            updateModList();
        }

        function updateModList() {
            const modListEl = document.getElementById('mod-list');
            modListEl.innerHTML = '';

            mods.forEach((mod, index) => {
                const modItem = document.createElement('div');
                modItem.className = 'mod-item';
                modItem.innerHTML = `
                    <input type="text" value="${mod}" placeholder="modÂêçÁß∞ (Â¶Ç: forge, optifine, jei)" 
                           onchange="mods[${index}] = this.value">
                    <button onclick="removeMod(${index})">Âà†Èô§</button>
                `;
                modListEl.appendChild(modItem);
            });
        }

        function addCommonMods() {
            const commonMods = ['forge', 'optifine', 'jei', 'journeymap', 'waila'];
            const selectedMods = prompt('ÈÄâÊã©Ë¶ÅÊ∑ªÂä†ÁöÑÂ∏∏Áî®mod (Áî®ÈÄóÂè∑ÂàÜÈöî):\n' + commonMods.join(', '));

            if (selectedMods) {
                const modsToAdd = selectedMods.split(',').map(m => m.trim()).filter(m => m);
                modsToAdd.forEach(mod => {
                    if (!mods.includes(mod)) {
                        mods.push(mod);
                    }
                });
                updateModList();
            }
        }

        function saveConfig() {
            const username = document.getElementById('username').value;
            const illegalChars = username.match(/[^a-zA-Z0-9]/g);

            if (!username.trim()) {
                alert('Áî®Êà∑Âêç‰∏çËÉΩ‰∏∫Á©∫ÂñµÔºÅ');
                return;
            }

            if (illegalChars && illegalChars.length > 0) {
                const suggestion = username.replace(/[^a-zA-Z0-9]/g, '') || 'BotSkon';
                alert(`Áî®Êà∑ÂêçÂåÖÂê´ÈùûÊ≥ïÂ≠óÁ¨¶: ${[...new Set(illegalChars)].join(', ')}\nÂª∫ËÆÆ‰øÆÊîπ‰∏∫: ${suggestion}`);
                return;
            }

            const serverAddress = document.getElementById('server-address').value.trim();
            let host = '';
            let port = '';

            if (serverAddress.includes(':')) {
                const parts = serverAddress.split(':');
                host = parts[0].trim();
                port = parts[1].trim();
            } else {
                host = serverAddress;
                port = '25565';
            }

            const newConfig = {
                ...config,
                client: {
                    ...config.client,
                    host: host,
                    port: port,
                    username: username,
                    version: document.getElementById('java-version').value,
                    auth: 'offline',
                    adaptiveMods: document.getElementById('adaptive-mods').checked,
                    mods: mods.filter(mod => mod.trim() !== ''),
                    skinMode: document.getElementById('skinMode').value,
                    skinUrl: document.getElementById('skinUrl').value || null
                }
            };

            const skinMode = document.getElementById('skinMode').value;

            if (skinMode === 'yggdrasil') {
                const skinServer = document.getElementById('skinServer').value;
                const customUrl = document.getElementById('customYggdrasilUrl').value;
                const yggdrasilUsername = document.getElementById('yggdrasilUsername').value;

                newConfig.client.yggdrasilServer = skinServer === 'custom' ? customUrl : skinServer;
                newConfig.client.yggdrasilUsername = yggdrasilUsername;
            }

            if (skinMode === 'littleskin') {
                const littleskinUsername = document.getElementById('littleskinUsername').value;
                const enableLittleskinAuth = document.getElementById('enableLittleskinAuth').checked;
                const littleskinPassword = document.getElementById('littleskinPassword').value;

                newConfig.client.littleskinUsername = littleskinUsername;
                newConfig.client.enableLittleskinAuth = enableLittleskinAuth;
                if (enableLittleskinAuth && littleskinPassword) {
                    newConfig.client.littleskinPassword = littleskinPassword;
                }
            }

            fetch('/api/config', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(newConfig)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('ÈÖçÁΩÆ‰øùÂ≠òÊàêÂäüÔºÅ');
                    config = newConfig;
                } else {
                    alert('‰øùÂ≠òÂ§±Ë¥•: ' + data.message);
                }
            })
            .catch(error => {
                console.error('‰øùÂ≠òÈÖçÁΩÆÂ§±Ë¥•:', error);
                alert('‰øùÂ≠òÈÖçÁΩÆÂ§±Ë¥•');
            });
        }

        function toggleBot() {
            const statusEl = document.getElementById('status');
            if (statusEl.className === 'status running') {
                stopBot();
            } else {
                startBot();
            }
        }

        function startBot() {
            document.getElementById('error-info').className = 'error-info hidden';

            fetch('/api/bot/start', { method: 'POST' })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert('Êú∫Âô®‰∫∫ÂêØÂä®ÊàêÂäüÔºÅ');
                        setTimeout(updateStatus, 1000);
                    } else {
                        alert('ÂêØÂä®Â§±Ë¥•: ' + data.message);
                    }
                })
                .catch(error => {
                    console.error('ÂêØÂä®Êú∫Âô®‰∫∫Â§±Ë¥•:', error);
                    alert('ÂêØÂä®Êú∫Âô®‰∫∫Â§±Ë¥•');
                });
        }

        function stopBot() {
            fetch('/api/bot/stop', { method: 'POST' })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert('Êú∫Âô®‰∫∫Â∑≤ÂÅúÊ≠¢ÔºÅ');
                        setTimeout(() => {
                            updateStatus();
                        }, 500);
                    } else {
                        alert('ÂÅúÊ≠¢Â§±Ë¥•: ' + data.message);
                    }
                })
                .catch(error => {
                    console.error('ÂÅúÊ≠¢Êú∫Âô®‰∫∫Â§±Ë¥•:', error);
                    alert('ÂÅúÊ≠¢Êú∫Âô®‰∫∫Â§±Ë¥•');
                });
        }

        function updateToggleButton(isRunning) {
            const toggleBtn = document.getElementById('toggle-btn');
            if (isRunning) {
                toggleBtn.textContent = '‚èπÔ∏è ÂÅúÊ≠¢Êú∫Âô®‰∫∫';
                toggleBtn.className = 'stop-btn';
            } else {
                toggleBtn.textContent = '‚ñ∂Ô∏è ÂêØÂä®Êú∫Âô®‰∫∫';
                toggleBtn.className = 'start-btn';
            }
        }

        let statusCheckErrors = 0;
        const maxStatusErrors = 3;

        function updateStatus() {
            fetch('/api/bot/status')
                .then(response => response.json())
                .then(data => {
                    // Áä∂ÊÄÅÊ£ÄÊü•ÊàêÂäüÔºåÈáçÁΩÆÈîôËØØËÆ°Êï∞
                    statusCheckErrors = 0;

                    const statusEl = document.getElementById('status');
                    const errorEl = document.getElementById('error-info');
                    const commandSection = document.getElementById('command-section');

                    if (data.running) {
                        statusEl.textContent = 'Êú∫Âô®‰∫∫Áä∂ÊÄÅ: ËøêË°å‰∏≠';
                        statusEl.className = 'status running';
                        errorEl.className = 'error-info hidden';
                        commandSection.style.display = 'block';
                        updateToggleButton(true);

                        if (!eventSource || eventSource.readyState === EventSource.CLOSED) {
                            connectToMessageStream();
                        }
                    } else {
                        statusEl.textContent = 'Êú∫Âô®‰∫∫Áä∂ÊÄÅ: Â∑≤ÂÅúÊ≠¢';
                        statusEl.className = 'status stopped';
                        commandSection.style.display = 'none';
                        updateToggleButton(false);

                        if (eventSource) {
                            eventSource.close();
                            eventSource = null;
                        }

                        if (data.error) {
                            errorEl.innerHTML = '<h4>üö® ÂêØÂä®Â§±Ë¥•ÂéüÂõ†:</h4>' + data.error;
                            errorEl.className = 'error-info';
                        } else {
                            errorEl.className = 'error-info hidden';
                        }
                    }
                })
                .catch(error => {
                    statusCheckErrors++;
                    
                    // Âè™Âú®ÂâçÂá†Ê¨°ÈîôËØØÊó∂ÊòæÁ§∫Êó•Âøó
                    if (statusCheckErrors <= maxStatusErrors) {
                        console.error(`Ëé∑ÂèñÁä∂ÊÄÅÂ§±Ë¥• (${statusCheckErrors}/${maxStatusErrors}):`, error);
                    }
                    
                    // Â¶ÇÊûúÈîôËØØÊ¨°Êï∞ËøáÂ§öÔºåÊòæÁ§∫Á¶ªÁ∫øÁä∂ÊÄÅ
                    if (statusCheckErrors > maxStatusErrors) {
                        const statusEl = document.getElementById('status');
                        statusEl.textContent = 'Êú∫Âô®‰∫∫Áä∂ÊÄÅ: ËøûÊé•ÊúçÂä°Âô®Â§±Ë¥•';
                        statusEl.className = 'status stopped';
                        statusEl.style.backgroundColor = '#f8d7da';
                        statusEl.style.color = '#721c24';
                    }
                });
        }

        function executeMinecraftCommand() {
            const command = document.getElementById('minecraft-command').value.trim();
            if (!command) {
                alert('ËØ∑ËæìÂÖ•ÂëΩ‰ª§ÂñµÔºÅ');
                return;
            }

            const fullCommand = command.startsWith('/') ? command : '/' + command;
            const timestamp = new Date().toISOString();

            // ËÆ∞ÂΩïÂëΩ‰ª§Âà∞Êó•Âøó
            addCommandLog(`üì§ ÊâßË°åÂëΩ‰ª§: ${fullCommand}`, timestamp, 'command');

            fetch('/api/bot/command', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ command: fullCommand })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    console.log(`‚úÖ ÂëΩ‰ª§ÊâßË°å: ${fullCommand}`);
                    addCommandLog(`‚úÖ ÂëΩ‰ª§Â∑≤ÂèëÈÄÅ: ${fullCommand}`, new Date().toISOString(), 'success');
                    document.getElementById('minecraft-command').value = '';
                } else {
                    console.log(`‚ùå ÂëΩ‰ª§Â§±Ë¥•: ${fullCommand} - ${data.message}`);
                    addCommandLog(`‚ùå ÂëΩ‰ª§Â§±Ë¥•: ${fullCommand} - ${data.message}`, new Date().toISOString(), 'error');
                }
            })
            .catch(error => {
                console.log(`‚ùå ÁΩëÁªúÈîôËØØ: ${fullCommand} - ${error.message}`);
                addCommandLog(`‚ùå ÁΩëÁªúÈîôËØØ: ${fullCommand} - ${error.message}`, new Date().toISOString(), 'error');
            });
        }

        function sendChatMessage() {
            const message = document.getElementById('chat-message').value.trim();
            if (!message) {
                alert('ËØ∑ËæìÂÖ•Ê∂àÊÅØÂñµÔºÅ');
                return;
            }

            const timestamp = new Date().toISOString();
            // ËÆ∞ÂΩïËÅäÂ§©Âà∞Êó•Âøó
            addCommandLog(`üí¨ ÂèëÈÄÅËÅäÂ§©: ${message}`, timestamp, 'chat');

            fetch('/api/bot/chat', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ message: message })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    console.log(`üí¨ ËÅäÂ§©ÂèëÈÄÅ: ${message}`);
                    addCommandLog(`‚úÖ ËÅäÂ§©Â∑≤ÂèëÈÄÅ: ${message}`, new Date().toISOString(), 'success');
                    document.getElementById('chat-message').value = '';
                } else {
                    console.log(`‚ùå ËÅäÂ§©Â§±Ë¥•: ${message} - ${data.message}`);
                    addCommandLog(`‚ùå ËÅäÂ§©Â§±Ë¥•: ${message} - ${data.message}`, new Date().toISOString(), 'error');
                }
            })
            .catch(error => {
                console.log(`‚ùå ÁΩëÁªúÈîôËØØ: ${message} - ${error.message}`);
                addCommandLog(`‚ùå ÁΩëÁªúÈîôËØØ: ${message} - ${error.message}`, new Date().toISOString(), 'error');
            });
        }

        let reconnectAttempts = 0;
        const maxReconnectAttempts = 10;
        let reconnectTimeout = null;
        let lastMessageTime = Date.now();
        let connectionStable = false;

        function connectToMessageStream() {
            if (eventSource) {
                eventSource.close();
                eventSource = null;
            }

            // ÂáèÂ∞ëÊéßÂà∂Âè∞Êó•ÂøóËæìÂá∫
            if (reconnectAttempts === 0) {
                console.log('üîó Ê≠£Âú®ËøûÊé•Âà∞Ê∂àÊÅØÊµÅ...');
            }

            try {
                eventSource = new EventSource('/api/events');

                eventSource.onopen = function(event) {
                    // ËøûÊé•ÊàêÂäüÔºåÈáçÁΩÆÈáçËøûËÆ°Êï∞Âô®
                    reconnectAttempts = 0;
                    connectionStable = true;
                    if (reconnectTimeout) {
                        clearTimeout(reconnectTimeout);
                        reconnectTimeout = null;
                    }
                    console.log('‚úÖ Ê∂àÊÅØÊµÅËøûÊé•ÊàêÂäü');
                    
                    // ËøûÊé•Á®≥ÂÆöÂêéÔºåÂú®Ê∂àÊÅØÂå∫ÂüüÊòæÁ§∫ËøûÊé•Áä∂ÊÄÅ
                    setTimeout(() => {
                        if (connectionStable) {
                            addServerMessage('üîó Ê∂àÊÅØÊµÅËøûÊé•Â∑≤Âª∫Á´ãÔºåÂºÄÂßãÁõëÊéßÊúçÂä°Âô®Ê∂àÊÅØ', new Date().toISOString(), 'system');
                        }
                    }, 500);
                };

                eventSource.onmessage = function(event) {
                    lastMessageTime = Date.now();
                    connectionStable = true;
                    
                    try {
                        console.log('üì• Êî∂Âà∞ÂéüÂßãSSEÊï∞ÊçÆ:', event.data);
                        const data = JSON.parse(event.data);
                        console.log('üìã Ëß£ÊûêÂêéÁöÑÊï∞ÊçÆ:', data);
                        
                        // Â§ÑÁêÜÂøÉË∑≥Ê∂àÊÅØ
                        if (data && data.type === 'heartbeat') {
                            // ÂøÉË∑≥Ê∂àÊÅØ‰∏çÈúÄË¶ÅÊòæÁ§∫Ôºå‰ΩÜÂèØ‰ª•Á°ÆËÆ§ËøûÊé•Ê¥ªË∑É
                            console.log('üíì ÂøÉË∑≥Ê≠£Â∏∏');
                            return;
                        }
                        
                        // Â§ÑÁêÜËøûÊé•Á°ÆËÆ§Ê∂àÊÅØ
                        if (data && data.type === 'connected') {
                            console.log('‚úÖ SSEËøûÊé•Â∑≤Âª∫Á´ã');
                            return;
                        }
                        
                        // È™åËØÅËÅäÂ§©ÂíåÁ≥ªÁªüÊ∂àÊÅØ
                        if (data && data.type && data.message !== undefined && data.message !== null && data.message !== '') {
                            console.log(`üéØ ÂáÜÂ§áÊòæÁ§∫Ê∂àÊÅØ [${data.type}]:`, data.message);
                            
                            // Á´ãÂç≥ÊòæÁ§∫Ê∂àÊÅØÔºåÂπ∂Ê∑ªÂä†Êó∂Èó¥Êà≥È™åËØÅ
                            try {
                                addServerMessage(data.message, data.timestamp, data.type);
                                console.log('‚úÖ Ê∂àÊÅØÂ∑≤ÊàêÂäüÊòæÁ§∫Âà∞ÁïåÈù¢');
                            } catch (displayError) {
                                console.error('‚ùå ÊòæÁ§∫Ê∂àÊÅØÂà∞ÁïåÈù¢Â§±Ë¥•:', displayError);
                            }
                        } else {
                            // Âè™ËÆ∞ÂΩïÁúüÊ≠£ÂºÇÂ∏∏ÁöÑÊ∂àÊÅØÊï∞ÊçÆ
                            if (data && Object.keys(data).length > 0) {
                                console.log('‚ö†Ô∏è Êî∂Âà∞Êó†ÊïàÊ∂àÊÅØÊï∞ÊçÆ:', {
                                    hasType: !!data.type,
                                    hasMessage: data.message !== undefined,
                                    messageValue: data.message,
                                    fullData: data
                                });
                            }
                        }
                    } catch (error) {
                        // ÊòæÁ§∫ÊâÄÊúâËß£ÊûêÈîôËØØÁî®‰∫éË∞ÉËØï
                        console.error('‚ùå Ëß£ÊûêÊ∂àÊÅØÂ§±Ë¥•:', error, 'ÂéüÂßãÊï∞ÊçÆ:', event.data);
                        
                        // Â∞ùËØïÂ∞ÜÂéüÂßãÊï∞ÊçÆ‰Ωú‰∏∫Á∫ØÊñáÊú¨ÊòæÁ§∫
                        if (event.data && event.data.trim()) {
                            addServerMessage(`ÂéüÂßãÊï∞ÊçÆ: ${event.data}`, new Date().toISOString(), 'debug');
                        }
                    }
                };

                eventSource.onerror = function(error) {
                    connectionStable = false;
                    
                    // ÈÅøÂÖçÈáçÂ§çÁöÑÈîôËØØÊó•Âøó
                    if (reconnectAttempts < maxReconnectAttempts) {
                        reconnectAttempts++;
                        
                        // Âè™Âú®ÂâçÂá†Ê¨°Â∞ùËØïÊó∂ÊòæÁ§∫ÈîôËØØ
                        if (reconnectAttempts <= 3) {
                            console.error(`üí• Ê∂àÊÅØÊµÅËøûÊé•ÈîôËØØ (${reconnectAttempts}/${maxReconnectAttempts}):`, error);
                            
                            // Âú®ÁïåÈù¢ÊòæÁ§∫ËøûÊé•ÈóÆÈ¢ò
                            if (reconnectAttempts === 1) {
                                addServerMessage('‚ö†Ô∏è Ê∂àÊÅØÊµÅËøûÊé•‰∏≠Êñ≠ÔºåÊ≠£Âú®Â∞ùËØïÈáçËøû...', new Date().toISOString(), 'system');
                            }
                        }

                        // Ê∏ÖÈô§‰πãÂâçÁöÑÈáçËøûÂÆöÊó∂Âô®
                        if (reconnectTimeout) {
                            clearTimeout(reconnectTimeout);
                        }

                        // Êõ¥Âø´ÈÄüÁöÑÈáçËøûÁ≠ñÁï•ÔºàÂáèÂ∞ëÂª∂ËøüÔºâ
                        const delay = Math.min(500 * reconnectAttempts, 3000);
                        
                        reconnectTimeout = setTimeout(() => {
                            if (document.getElementById('status').className === 'status running') {
                                console.log(`üîÑ Â∞ùËØïÈáçËøû (${reconnectAttempts}/${maxReconnectAttempts})...`);
                                connectToMessageStream();
                            }
                        }, delay);
                    } else {
                        console.error('‚ùå SSEËøûÊé•Â§±Ë¥•Ê¨°Êï∞ËøáÂ§öÔºåÂÅúÊ≠¢ÈáçËøû');
                        // ÊòæÁ§∫ËøûÊé•Áä∂ÊÄÅÂú®UI‰∏ä
                        addServerMessage('‚ùå Ê∂àÊÅØÊµÅËøûÊé•Â§±Ë¥•Ê¨°Êï∞ËøáÂ§öÔºåËØ∑Âà∑Êñ∞È°µÈù¢ÊàñÈáçÂêØÊú∫Âô®‰∫∫', new Date().toISOString(), 'system');
                    }
                };

            } catch (error) {
                if (reconnectAttempts < 2) {
                    console.error('üí• ÂàõÂª∫Ê∂àÊÅØÊµÅËøûÊé•Â§±Ë¥•:', error);
                }
            }
        }

        function addServerMessage(message, timestamp, messageType) {
            const messagesEl = document.getElementById('server-messages');
            if (!messagesEl) {
                console.error('‚ùå Êâæ‰∏çÂà∞Ê∂àÊÅØÊòæÁ§∫ÂÆπÂô®');
                return;
            }

            // È™åËØÅÊ∂àÊÅØ‰∏ç‰∏∫Á©∫Êàñundefined
            if (!message || message === 'undefined' || message.trim() === '') {
                console.log('‚ö†Ô∏è Êî∂Âà∞Á©∫Ê∂àÊÅØÔºåË∑≥ËøáÊòæÁ§∫');
                return;
            }

            console.log(`üé® Ê≠£Âú®ÊòæÁ§∫Ê∂àÊÅØÂà∞ÁïåÈù¢: [${messageType}] ${message}`);

            // È™åËØÅÊó∂Èó¥Êà≥
            if (!timestamp) {
                timestamp = new Date().toISOString();
                console.log('‚ö†Ô∏è Ê∂àÊÅØÁº∫Â∞ëÊó∂Èó¥Êà≥Ôºå‰ΩøÁî®ÂΩìÂâçÊó∂Èó¥');
            }

            const time = new Date(timestamp).toLocaleTimeString();
            const messageDiv = document.createElement('div');
            
            // Ê†πÊçÆÊ∂àÊÅØÁ±ªÂûãËÆæÁΩÆ‰∏çÂêåÁöÑÊ†∑ÂºèÂíåÂõæÊ†á
            let icon = 'üí¨';
            let bgColor = '#f8f9fa';
            let borderColor = '#ddd';
            let textColor = '#333';
            
            switch(messageType) {
                case 'chat':
                    icon = 'üí¨';
                    bgColor = '#e8f5e8';
                    borderColor = '#4caf50';
                    textColor = '#2e7d32';
                    break;
                case 'system':
                    icon = 'üîß';
                    bgColor = '#e3f2fd';
                    borderColor = '#2196f3';
                    textColor = '#1565c0';
                    break;
                case 'server':
                    icon = 'üìã';
                    bgColor = '#f3e8ff';
                    borderColor = '#6f42c1';
                    textColor = '#5a2d91';
                    break;
                case 'game':
                    icon = 'üéÆ';
                    bgColor = '#fff3e0';
                    borderColor = '#ff9800';
                    textColor = '#e65100';
                    break;
                default:
                    icon = 'üí¨';
                    break;
            }
            
            messageDiv.style.cssText = `margin-bottom: 3px; padding: 8px; border-radius: 4px; border-left: 3px solid ${borderColor}; background-color: ${bgColor}; color: ${textColor};`;
            messageDiv.innerHTML = `
                <div style="font-size: 11px; color: #666; margin-bottom: 2px;">[${time}] ${messageType || 'unknown'}</div>
                <div style="font-family: 'Courier New', monospace; font-size: 13px;">${icon} ${message}</div>
            `;

            messagesEl.appendChild(messageDiv);

            // Ê£ÄÊü•ÊòØÂê¶ÊòØÂëΩ‰ª§Áõ∏ÂÖ≥ÁöÑÊúçÂä°Âô®ÂìçÂ∫îÔºåÂ¶ÇÊûúÊòØÂàô‰πüËÆ∞ÂΩïÂà∞Êåá‰ª§Êó•Âøó
            const isCommandResponse = message.includes('ÁßçÂ≠ê') || 
                                     message.includes('Seed') || 
                                     message.includes('seed:') ||
                                     message.includes('Âú®Á∫øÁé©ÂÆ∂') || 
                                     message.includes('players online') ||
                                     message.includes('There are') ||
                                     message.includes('ÂΩìÂâçÊúâ') ||
                                     message.includes('list:') ||
                                     message.includes('gamemode') ||
                                     message.includes('Ê®°Âºè') ||
                                     message.includes('tp') ||
                                     message.includes('‰º†ÈÄÅ') ||
                                     message.includes('time') ||
                                     message.includes('Êó∂Èó¥') ||
                                     message.includes('weather') ||
                                     message.includes('Â§©Ê∞î') ||
                                     message.includes('Unknown command') ||
                                     message.includes('Êú™Áü•ÂëΩ‰ª§') ||
                                     message.includes('ÊùÉÈôê') ||
                                     message.includes('permission');

            if (isCommandResponse) {
                addCommandLog(`üì• ÊúçÂä°Âô®ÂìçÂ∫î: ${message}`, timestamp, 'response');
            }

            if (autoScroll) {
                messagesEl.scrollTop = messagesEl.scrollHeight;
            }

            while (messagesEl.children.length > 200) {
                messagesEl.removeChild(messagesEl.firstChild);
            }
        }

        function clearServerMessages() {
            document.getElementById('server-messages').innerHTML = '';
        }

        function toggleAutoScroll() {
            autoScroll = !autoScroll;
            const btn = document.getElementById('auto-scroll-btn');
            btn.textContent = `Ëá™Âä®ÊªöÂä®: ${autoScroll ? 'ÂºÄ' : 'ÂÖ≥'}`;
            btn.style.backgroundColor = autoScroll ? '#28a745' : '#6c757d';
        }

        function addCommandLog(message, timestamp, logType) {
            const time = new Date(timestamp).toLocaleTimeString();
            const logEntry = {
                message: message,
                timestamp: timestamp,
                type: logType,
                time: time
            };

            commandLogs.push(logEntry);

            // ÈôêÂà∂Êó•ÂøóÊï∞Èáè
            if (commandLogs.length > maxCommandLogs) {
                commandLogs = commandLogs.slice(-maxCommandLogs);
            }

            updateCommandLogDisplay();
        }

        function updateCommandLogDisplay() {
            const logsEl = document.getElementById('command-logs');
            if (!logsEl) return;

            // Âè™ÊòæÁ§∫ÊúÄËøëÁöÑÊó•ÂøóÊù°ÁõÆÔºåÈÅøÂÖçDOMËøáÂ§ß
            const displayLogs = commandLogs.slice(-50);
            logsEl.innerHTML = '';

            displayLogs.forEach(log => {
                const logDiv = document.createElement('div');
                let bgColor = '#f8f9fa';
                let borderColor = '#ddd';
                let textColor = '#333';

                switch (log.type) {
                    case 'command':
                        bgColor = '#fff3e0';
                        borderColor = '#ff9800';
                        textColor = '#e65100';
                        break;
                    case 'chat':
                        bgColor = '#e8f5e8';
                        borderColor = '#4caf50';
                        textColor = '#2e7d32';
                        break;
                    case 'success':
                        bgColor = '#e8f5e8';
                        borderColor = '#4caf50';
                        textColor = '#2e7d32';
                        break;
                    case 'error':
                        bgColor = '#ffebee';
                        borderColor = '#f44336';
                        textColor = '#c62828';
                        break;
                    case 'response':
                        bgColor = '#e3f2fd';
                        borderColor = '#2196f3';
                        textColor = '#1565c0';
                        break;
                }

                logDiv.style.cssText = `
                    margin-bottom: 3px; 
                    padding: 6px; 
                    border-radius: 4px; 
                    border-left: 3px solid ${borderColor}; 
                    background-color: ${bgColor};
                    color: ${textColor};
                `;

                logDiv.innerHTML = `
                    <div style="font-size: 10px; color: #666; margin-bottom: 2px;">[${log.time}]</div>
                    <div style="font-family: 'Courier New', monospace; font-size: 12px;">${log.message}</div>
                `;

                logsEl.appendChild(logDiv);
            });

            // Ëá™Âä®ÊªöÂä®Âà∞Â∫ïÈÉ®
            logsEl.scrollTop = logsEl.scrollHeight;
        }

        function clearCommandLogs() {
            commandLogs = [];
            document.getElementById('command-logs').innerHTML = '';
            addCommandLog('üìã Êåá‰ª§Êó•ÂøóÂ∑≤Ê∏ÖÈô§', new Date().toISOString(), 'success');
        }

        function exportCommandLogs() {
            if (commandLogs.length === 0) {
                alert('Ê≤°ÊúâÊó•ÂøóÂèØ‰ª•ÂØºÂá∫ÂñµÔºÅ');
                return;
            }

            const logText = commandLogs.map(log => {
                return `[${new Date(log.timestamp).toLocaleString()}] ${log.message}`;
            }).join('\n');

            const blob = new Blob([logText], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `aterbot-ÂëΩ‰ª§Êó•Âøó-${new Date().toISOString().slice(0, 10)}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            addCommandLog(`üìÅ Â∑≤ÂØºÂá∫ ${commandLogs.length} Êù°Êó•ÂøóËÆ∞ÂΩï`, new Date().toISOString(), 'success');
        }

        function suggestUsername() {
            const simpleNames = ['BotSkon', 'AterBot', 'AutoBot', 'HelperBot', 'TestBot', 'PlayerBot', 'GameBot', 'MCBot'];
            const suggestedName = simpleNames[Math.floor(Math.random() * simpleNames.length)];

            document.getElementById('username').value = suggestedName;

            alert(`üí° Êé®ËçêÁî®Êà∑Âêç: ${suggestedName}\n\nËøô‰∏™ÂêçÂ≠óÂÆåÂÖ®Á¨¶ÂêàMinecraftÊúçÂä°Âô®Ë¶ÅÊ±ÇÔºåÂèØ‰ª•Â∞ùËØï‰ΩøÁî®ÂñµÔºÅ`);
        }

        // ÂõûËΩ¶ÈîÆÂø´Êç∑ÊâßË°å
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('minecraft-command').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    executeMinecraftCommand();
                }
            });

            document.getElementById('chat-message').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    sendChatMessage();
                }
            });

            // Ê∑ªÂä†ËæìÂÖ•Ê°Ü‰∫ã‰ª∂ÁõëÂê¨Âô®
            document.getElementById('server-address').addEventListener('input', function() {
                parseServerAddress(this);
            });

            document.getElementById('username').addEventListener('input', function() {
                validateUsername(this);
            });
        });
    </script>
</body>
</html>
